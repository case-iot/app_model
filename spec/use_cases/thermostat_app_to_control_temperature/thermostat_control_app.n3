# app for controlling the thermostat

@prefix case: <http://matus.tomlein.org/case/>.
@prefix question: <http://matus.tomlein.org/case/>.
@prefix local: <http://102.12.124.12/>.
@prefix dbpedia: <http://dbpedia.org/resource/>.

local:question a question:Question;
  question:text "What is the target temperature?";
  question:replyType question:temperature.

_:app a case:Application;
  case:name "TempControllerPro";
  case:description "An app for controlling the temperature based on the given setpoint";
  case:actions (
    local:set_temperature_action
  ).

local:set_temperature_action case:description "Set temperature";
  case:requirement (
    local:thermostat_requirement
    local:temperature_set_requirement
  ).

local:thermostat_requirement case:description "Thermostat needed".
local:temperature_set_requirement case:description "Question not answered";
  case:requires_answering local:question.

{
  ?thermostat a case:Device; a dbpedia:Thermostat.
} => {
  local:thermostat_requirement case:satisfied true.
  local:thermostat_requirement case:satisfied_with ?thermostat.
}.

{
  ?answer question:answers local:question.
  ?answer case:in_celsius ?temperature.
} => {
  local:temperature_set_requirement case:satisfied true.
  local:temperature_set_requirement case:satisfied_with ?temperature.
}.

{
  local:thermostat_requirement case:satisfied_with ?thermostat.
  local:temperature_set_requirement case:satisfied_with ?temperature.
  ?thermostat case:set_temp_url ?url.
} => {
  local:set_temperature_action case:requests ( [
    <http://www.w3.org/2011/http#methodName> "POST";
    <http://www.w3.org/2011/http#body> ?temperature;
    <http://www.w3.org/2011/http#requestURI> ?url
  ] ).
}.

#  local:set_temperature_action case:promises ( _:state_change).
#  _:state_change a st:StateChange;
#    st:removed { ?place ex:hasTemp ?oldTemp. };
#    st:added { ?place ex:hasTemp ?newTemp. };
#    st:parent ?state.
#  ).
